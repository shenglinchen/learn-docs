# 入门

[相关链接](https://developer.chrome.com/extensions/getstarted)

## 目录

[TOC]

## 一、创建 `manifest.json` 文件

```json
{
  "name": "app-name",
  "version": "1.0.0",
  "manifest_version": 2,
  "descripton": "description",
  "icons": {
    "16": "url",
    "48": "url"
    
  }
}
```



1. manifest文件是 chrome 扩展程序的基础，通过这个文件，才能配置插件
2. 选项：
   1. `name`: 插件名
   2. `description`: 描述插件功能，
   3. `version`: 插件版本
   4. `manifest_version`: 必须写2
   5. `icons`: 当`icon`的大小接近 `16`像素时，会将`16`指向的图片加载上去。图片格式目前必须是 `png`
   6. ![image-20190711001156414](/Users/mac/Library/Application Support/typora-user-images/image-20190711001156414.png)
   7. ![image-20190711001343869](/Users/mac/Library/Application Support/typora-user-images/image-20190711001343869.png)



## 二、创建背景脚本

```json
// manifest.json
{
	...
  background: {
    "scripts": string[],
    "persistent": boolean
  }
  ...
}
```

1. `background`: 配置背景脚本选项，
   1. `scripts`: 文件路径数组，例如["./js/background.js"]。这些文件将会在后台执行
   2. `persistent`: 是否持续有效

```js
// background.js
chrome.runtime.onInstalled.addListener(function() {
    chrome.storage.sync.set({color: '#3aa757'}, function() {
      console.log("The color is green.");
    });
  });
```

2. 这里的`api`暂时不需要懂，大概就是在谷歌运行时在储存空间`storage`内写入 `color`，并打印"The color is green."

```js
// manifest.json
{
  ...
  "permissions": ["storage"],
  ...
}
```

3. 因为用到了 `storage`这个 `api`，所以需要在 `permission` 里注册

![image-20190711002758111](/Users/mac/Library/Application Support/typora-user-images/image-20190711002758111.png)

## 三、创建用户界面

```json
// manifest.json
{
...
	"page_action": {
		"default_popup": "./html/popup.html",
		"default_icon": {
			"16": "url"
		}
	}

...
}
```

1. 通过 `page_action`配置在特定页面才会触发的行为(还有另一个`browser_action`配置在浏览器全局都可以触发的行为
2. `default_iocn`也是设置右上角的图标，且层级比 `icons`高

```html
// popup.html 
<!DOCTYPE html>
  <html>
    <head>
      <style>
        button {
          height: 30px;
          width: 30px;
          outline: none;
        }
      </style>
    </head>
    <body>
      <button id="changeColor"></button>
    </body>
    <script src="../js/popup.js"></script>
  </html>
```

3. 在弹出的页面写入一个按钮

```JS
  // background.js 
chrome.runtime.onInstalled.addListener(function() {
    chrome.storage.sync.set({color: '#3aa757'}, function() {
      console.log('The color is green.');
    });
    chrome.declarativeContent.onPageChanged.removeRules(undefined, function() {
      chrome.declarativeContent.onPageChanged.addRules([{
        conditions: [new chrome.declarativeContent.PageStateMatcher({
          pageUrl: {hostEquals: 'developer.chrome.com'},
        })
        ],
            actions: [new chrome.declarativeContent.ShowPageAction()]
      }]);
    });
  });
```

4. 在background.js 里添加一段代码，表示在developer.chrome.com域名下激活改插件

```json
// manifest.json
{
    "name": "Getting Started Example",
  ...
    "permissions": ["declarativeContent", "storage"],
  ...
  }
```

5. 注册相关api

```js
  // popup.js
  
  let changeColor = document.getElementById('changeColor');

  chrome.storage.sync.get('color', function(data) {
    changeColor.style.backgroundColor = data.color;
    changeColor.setAttribute('value', data.color);
  });
```

6. 更换按钮颜色
7. 

![image-20190711003523345](/Users/mac/Library/Application Support/typora-user-images/image-20190711003523345.png)

## 四、实现功能

```JS
// popup.js
let changeColor = document.getElementById('changeColor');
  ...
  changeColor.onclick = function(element) {
    let color = element.target.value;
    chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {
      chrome.tabs.executeScript(
          tabs[0].id,
          {code: 'document.body.style.backgroundColor = "' + color + '";'});
    });
  };
```

1. 点击换色

```json
  // manifest.json
  {
    "name": "Getting Started Example",
  ...
    "permissions": ["activeTab", "declarativeContent", "storage"],
  ...
  }
```



2. 注册相关api



## 五、选项页

```HTML
 <!DOCTYPE html>
  <html>
    <head>
      <style>
        button {
          height: 30px;
          width: 30px;
          outline: none;
          margin: 10px;
        }
      </style>
    </head>
    <body>
      <div id="buttonDiv">
      </div>
      <div>
        <p>Choose a different background color!</p>
      </div>
    </body>
    <script src="options.js"></script>
  </html>
```

1. 选项页面

```json
// manifest.json
{
    "name": "Getting Started Example",
    ...
    "options_page": "options.html",
    ...
    "manifest_version": 2
  }
```



2. 注册选项页面

```js
// popup.js
let page = document.getElementById('buttonDiv');
  const kButtonColors = ['#3aa757', '#e8453c', '#f9bb2d', '#4688f1'];
  function constructOptions(kButtonColors) {
    for (let item of kButtonColors) {
      let button = document.createElement('button');
      button.style.backgroundColor = item;
      button.addEventListener('click', function() {
        chrome.storage.sync.set({color: item}, function() {
          console.log('color is ' + item);
        })
      });
      page.appendChild(button);
    }
  }
  constructOptions(kButtonColors);
```



3. 循环生成按钮

   

![image-20190711004428815](/Users/mac/Library/Application Support/typora-user-images/image-20190711004428815.png

![image-20190711004455148](/Users/mac/Library/Application Support/typora-user-images/image-20190711004455148.png)

![image-20190711004634434](/Users/mac/Library/Application Support/typora-user-images/image-20190711004634434.png)